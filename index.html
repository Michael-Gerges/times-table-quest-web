<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Albert's Times Table Quest</title>
  <link rel="stylesheet" href="/style.css" />
</head>
<body>
  <aside id="side">
    <h2>Times (previous)</h2>
    <ul id="times"></ul>
  </aside>

  <header id="top">
    <h1>Albert's Times Table Quest</h1>
    <div id="tablePicker">
      <label for="tableSelect">Table:</label>
      <select id="tableSelect">
        <option value="1">1</option>
        <option value="2">2</option>
        <option value="3" selected>3</option>
        <option value="4">4</option>
        <option value="5">5</option>
        <option value="6">6</option>
        <option value="7">7</option>
        <option value="8">8</option>
        <option value="9">9</option>
        <option value="10">10</option>
        <option value="11">11</option>
        <option value="12">12</option>
      </select>
    </div>
    <div id="status">Streak 0 | Stars 0 | Mastered 0/0</div>
    <div id="timer">0.0s</div>
    <a id="usageLink" href="/submissions.html">Usage logs</a>
  </header>

  <main id="main">
    <div id="question"></div>
    <div id="inputRow">
      <input id="answer" type="hidden" />
      <div id="answerDisplay"></div>
      <div id="keypad" class="keypad"></div>
      <button id="check">Check</button>
    </div>
    <div id="feedback"></div>
    <canvas id="hintCanvas" width="800" height="420"></canvas>
    <div id="controls">
      <button id="toggleHint">Toggle Hint</button>
      <progress id="progress" value="0" max="0"></progress>
      <button id="skip">Skip</button>
      <button id="exit">Exit</button>
    </div>
  </main>

  <div id="celebration">
    <video id="goalVideo" src="/assets/videoshort.mp4" preload="none" playsinline></video>
    <audio id="cheerAudio" src="/assets/crowd cheering.mp3" preload="none"></audio>
    <audio id="booAudio" src="/assets/crowd disappointment.mp3" preload="none"></audio>
  </div>

  <script type="module" src="/src/main.js"></script>
  <script type="module">
  (async () => {
    try {
      const ipRes = await fetch('https://api.ipify.org?format=json');
      const { ip } = await ipRes.json();
      const value = `${new Date().toISOString()}\t${ip}\tpage_view\tpath=${location.pathname} ua=${navigator.userAgent}`;
      await fetch('/.netlify/functions/submit', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ value })
      });
    } catch (e) {}
  })();
  </script>
</body>
</html>
